<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - The Cryptic Legion</title>
    <link rel="icon" type="image/png" href="The_Cryptic_Legion_Logo__1_-removebg-preview.png" sizes="32x32">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        /* Your CSS remains unchanged */
        :root { --montserrat: "Montserrat", sans-serif; --main3: #101c32; --main4: #0c1525; --main5: #060b14; --white: #fff; --Vwhite: #e9e7e7; --dwhite: #cccccc; --bg1: #2e3267; --container-width-lg: 80%; --trensition: all 400ms ease; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: var(--montserrat); line-height: 1.7; color: var(--white); background: var(--main4); }
        .container { width: var(--container-width-lg); margin: 0 auto; }
        h1, h2, h3 { line-height: 1.2; margin-bottom: 1rem; color: var(--Vwhite); }
        h1 { font-size: 2.5rem; text-align: center; margin: 2rem 0; padding-bottom: 1rem; border-bottom: 2px solid var(--bg1); }
        h2 { margin-top: 2.5rem; color: #ebd978; }
        .btn { display: inline-block; padding: 12px 24px; margin-top: 1rem; color: var(--white); background: var(--main3); border-radius: 5px; cursor: pointer; text-align: center; border: none; font-size: 1rem; font-family: var(--montserrat); transition: var(--trensition); }
        .btn:hover { background: var(--bg1); }
        .btn-danger { background: #f75842; margin-left: 10px; }
        .btn-danger:hover { background: #e0432d; }
        .admin-section { background: var(--main5); padding: 2rem; margin-bottom: 2rem; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        .management-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1.5rem; }
        .item-card { background: var(--main3); border-radius: 8px; overflow: hidden; text-align: center; padding: 1rem; transition: var(--trensition); display: flex; flex-direction: column; justify-content: space-between; }
        .item-card:hover { transform: translateY(-5px); box-shadow: 0 8px 20px rgba(0,0,0,0.4); }
        .item-card img, .item-card video { width: 100%; height: 150px; object-fit: cover; border-radius: 5px; margin-bottom: 1rem; }
        .item-card p { font-size: 0.9rem; color: var(--dwhite); margin-bottom: 1rem; flex-grow: 1; }
        .form-group { margin-bottom: 1.5rem; }
        .form-group label { display: block; margin-bottom: 0.5rem; font-weight: 600; }
        .form-group input[type="file"], .form-group input[type="text"], .form-group textarea { width: 100%; padding: 10px; border-radius: 5px; border: 1px solid var(--bg1); background: var(--main4); color: var(--white); font-family: var(--montserrat); }
        .back-link { display: inline-block; margin: 2rem 0 0 2rem; color: #ebd978; text-decoration: none; font-weight: 500; }
        .back-link i { margin-right: 8px; }
    </style>
</head>
<body>
    <a href="index.html" class="back-link"><i class='bx bx-arrow-back'></i>Back to Home</a>
    <div class="container">
        <h1>Admin Control Panel</h1>

        <section class="admin-section">
            <h2>Manage Header Images</h2>
            <div id="header-images-grid" class="management-grid"></div>
            <div class="form-group">
                <label for="new-image-upload">Upload New Header Image</label>
                <input type="file" id="new-image-upload" accept="image/*">
                <p id="image-upload-status" style="display: none; color: #ebd978;">Uploading...</p>
                <button class="btn" onclick="addImage()">Add Image</button>
            </div>
        </section>

        <section class="admin-section">
            <h2>Manage Highlight Videos</h2>
            <div id="videos-grid" class="management-grid"></div>
            <div class="form-group">
                <label for="new-video-upload">Upload New Video</label>
                <input type="file" id="new-video-upload" accept="video/*">
            </div>
            <div class="form-group">
                <label for="new-video-description">Video Description</label>
                <input type="text" id="new-video-description" placeholder="e.g., Enzo Fernandez funny moment...">
            </div>
            <p id="video-upload-status" style="display: none; color: #ebd978;">Uploading...</p>
            <button class="btn" onclick="addVideo()">Add Video</button>
        </section>
        
        <section class="admin-section">
            <h2>Manage Live Reports / Testimonials</h2>
            <div id="testimonials-grid" class="management-grid"></div>
            <div class="form-group">
                <label for="new-testimonial-avatar">Avatar Image</label>
                <input type="file" id="new-testimonial-avatar" accept="image/*">
            </div>
            <div class="form-group">
                <label for="new-testimonial-name">Person's Name</label>
                <input type="text" id="new-testimonial-name" placeholder="e.g., David Okereke">
            </div>
            <div class="form-group">
                <label for="new-testimonial-role">Role</label>
                <input type="text" id="new-testimonial-role" placeholder="e.g., Parent">
            </div>
            <div class="form-group">
                <label for="new-testimonial-body">Quote / Message</label>
                <textarea id="new-testimonial-body" rows="4" placeholder="Enter the testimonial message here..."></textarea>
            </div>
            <p id="testimonial-upload-status" style="display: none; color: #ebd978;">Uploading avatar...</p>
            <button class="btn" onclick="addTestimonial()">Add Testimonial</button>
        </section>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-storage-compat.js"></script>
    
    <script>
        // IMPORTANT: PASTE YOUR REAL FIREBASE KEYS HERE!
        const firebaseConfig = {
        apiKey: "AIzaSyCuuqTPYzVXUIY6vKTRlywrn0SrGp2EApA",
        authDomain: "cryptic-legion-admin.firebaseapp.com",
        projectId: "cryptic-legion-admin",
        storageBucket: "cryptic-legion-admin.firebasestorage.app",
        messagingSenderId: "699875847338",
        appId: "1:699875847338:web:94b39b8e1229d2df9a34d3"
        };

        firebase.initializeApp(firebaseConfig);
        const storage = firebase.storage();

        document.addEventListener('DOMContentLoaded', function() {
            // DOM Elements
            const imagesGrid = document.getElementById('header-images-grid');
            const videosGrid = document.getElementById('videos-grid');
            const testimonialsGrid = document.getElementById('testimonials-grid');

            // Status Messages
            const imageUploadStatus = document.getElementById('image-upload-status');
            const videoUploadStatus = document.getElementById('video-upload-status');
            const testimonialUploadStatus = document.getElementById('testimonial-upload-status');

            // localStorage Keys
            const IMAGE_STORAGE_KEY = 'crypticLegionImages';
            const VIDEO_STORAGE_KEY = 'crypticLegionVideos';
            const TESTIMONIAL_STORAGE_KEY = 'crypticLegionTestimonials';

            const getStoredData = (key) => JSON.parse(localStorage.getItem(key)) || [];
            const setStoredData = (key, data) => localStorage.setItem(key, JSON.stringify(data));
            
            // --- RENDER FUNCTIONS ---
            const renderImages = () => {
                imagesGrid.innerHTML = '';
                getStoredData(IMAGE_STORAGE_KEY).forEach(image => {
                    const card = document.createElement('div');
                    card.className = 'item-card';
                    card.innerHTML = `<img src="${image.src}" alt="Header Image"><button class="btn btn-danger" onclick="deleteItem('image', ${image.id})">Delete</button>`;
                    imagesGrid.appendChild(card);
                });
            };

            const renderVideos = () => {
                videosGrid.innerHTML = '';
                getStoredData(VIDEO_STORAGE_KEY).forEach(video => {
                    const card = document.createElement('div');
                    card.className = 'item-card';
                    card.innerHTML = `<video src="${video.src}" controls loop></video><p>${video.description}</p><button class="btn btn-danger" onclick="deleteItem('video', ${video.id})">Delete</button>`;
                    videosGrid.appendChild(card);
                });
            };

            const renderTestimonials = () => {
                testimonialsGrid.innerHTML = '';
                getStoredData(TESTIMONIAL_STORAGE_KEY).forEach(t => {
                    const card = document.createElement('div');
                    card.className = 'item-card';
                    card.innerHTML = `
                        <div>
                            <img src="${t.avatarSrc}" alt="Avatar" style="width: 80px; height: 80px; border-radius: 50%;">
                            <h5>${t.name}</h5>
                            <small>${t.role}</small>
                            <p style="font-size: 0.8rem; margin-top: 1rem;">"${t.body}"</p>
                        </div>
                        <button class="btn btn-danger" onclick="deleteItem('testimonial', ${t.id})">Delete</button>`;
                    testimonialsGrid.appendChild(card);
                });
            };

            // --- DELETE FUNCTION ---
            window.deleteItem = (type, id) => {
                 if (confirm('Are you sure you want to delete this item?')) {
                    let key, renderFunc;
                    if (type === 'image') { key = IMAGE_STORAGE_KEY; renderFunc = renderImages; }
                    else if (type === 'video') { key = VIDEO_STORAGE_KEY; renderFunc = renderVideos; }
                    else if (type === 'testimonial') { key = TESTIMONIAL_STORAGE_KEY; renderFunc = renderTestimonials; }
                    
                    if (key) {
                        let data = getStoredData(key);
                        data = data.filter(item => item.id !== id);
                        setStoredData(key, data);
                        renderFunc();
                    }
                }
            };

            // --- UPLOAD HELPER FUNCTION ---
            const uploadFile = (file, path, statusElement) => {
                return new Promise((resolve, reject) => {
                    statusElement.style.display = 'block';
                    const storageRef = storage.ref(path);
                    const uploadTask = storageRef.put(file);

                    uploadTask.on('state_changed', 
                        (snapshot) => {
                            const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                            statusElement.textContent = `Uploading: ${Math.round(progress)}%`;
                        }, 
                        (error) => {
                            console.error("Upload failed:", error);
                            statusElement.style.display = 'none';
                            reject(error);
                        }, 
                        () => {
                            uploadTask.snapshot.ref.getDownloadURL().then((downloadURL) => {
                                statusElement.style.display = 'none';
                                resolve(downloadURL);
                            });
                        }
                    );
                });
            };

            // --- ADD FUNCTIONS (NOW ALL POWERED BY FIREBASE) ---
            window.addImage = async () => {
                const imageInput = document.getElementById('new-image-upload');
                const file = imageInput.files[0];
                if (!file) { alert('Please select an image file.'); return; }

                try {
                    const filePath = `images/${Date.now()}-${file.name}`;
                    const downloadURL = await uploadFile(file, filePath, imageUploadStatus);
                    
                    const newItem = { id: Date.now(), src: downloadURL };
                    const data = getStoredData(IMAGE_STORAGE_KEY);
                    data.push(newItem);
                    setStoredData(IMAGE_STORAGE_KEY, data);
                    renderImages();
                    imageInput.value = '';
                    alert('Image uploaded successfully!');
                } catch (error) {
                    alert('Image upload failed. Please try again.');
                }
            };

            window.addVideo = async () => {
                const videoInput = document.getElementById('new-video-upload');
                const descInput = document.getElementById('new-video-description');
                const file = videoInput.files[0];
                if (!file || !descInput.value.trim()) { alert('Please select a video file and provide a description.'); return; }

                try {
                    const filePath = `videos/${Date.now()}-${file.name}`;
                    const downloadURL = await uploadFile(file, filePath, videoUploadStatus);

                    const newItem = { id: Date.now(), src: downloadURL, description: descInput.value.trim() };
                    const data = getStoredData(VIDEO_STORAGE_KEY);
                    data.push(newItem);
                    setStoredData(VIDEO_STORAGE_KEY, data);
                    renderVideos();
                    videoInput.value = '';
                    descInput.value = '';
                    alert('Video uploaded successfully!');
                } catch (error) {
                    alert('Video upload failed. Please try again.');
                }
            };
            
            window.addTestimonial = async () => {
                const avatarInput = document.getElementById('new-testimonial-avatar');
                const nameInput = document.getElementById('new-testimonial-name');
                const roleInput = document.getElementById('new-testimonial-role');
                const bodyInput = document.getElementById('new-testimonial-body');
                const file = avatarInput.files[0];

                if (!file || !nameInput.value.trim() || !roleInput.value.trim() || !bodyInput.value.trim()) {
                    alert('Please fill out all testimonial fields and select an avatar.'); return;
                }

                try {
                    const filePath = `avatars/${Date.now()}-${file.name}`;
                    const avatarUrl = await uploadFile(file, filePath, testimonialUploadStatus);

                    const newItem = {
                        id: Date.now(),
                        avatarSrc: avatarUrl,
                        name: nameInput.value.trim(),
                        role: roleInput.value.trim(),
                        body: bodyInput.value.trim()
                    };
                    const data = getStoredData(TESTIMONIAL_STORAGE_KEY);
                    data.push(newItem);
                    setStoredData(TESTIMONIAL_STORAGE_KEY, data);
                    renderTestimonials();
                    avatarInput.value = nameInput.value = roleInput.value = bodyInput.value = '';
                    alert('Testimonial added successfully!');
                } catch (error) {
                    alert('Failed to add testimonial. Please try again.');
                }
            };
            
            // --- INITIAL RENDER ON PAGE LOAD ---
            renderImages();
            renderVideos();
            renderTestimonials();
        });
    </script>
</body>
</html>
