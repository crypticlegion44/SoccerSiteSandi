<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - The Cryptic Legion</title>
    <link rel="icon" type="image/png" href="The_Cryptic_Legion_Logo__1_-removebg-preview.png" sizes="32x32">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        /* Your Admin Panel CSS (Unchanged for brevity) */
        :root { --montserrat: "Montserrat", sans-serif; --main: #ebd978; --main3: #101c32; --main4: #0c1525; --main5: #060b14; --white: #fff; --Vwhite: #e9e7e7; --dwhite: #cccccc; --bg1: #2e3267; --container-width-lg: 80%; --trensition: all 400ms ease; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: var(--montserrat); line-height: 1.7; color: var(--white); background: var(--main4); }
        .container { width: var(--container-width-lg); margin: 0 auto; }
        h1, h2, h3 { line-height: 1.2; margin-bottom: 1rem; color: var(--Vwhite); }
        h1 { font-size: 2.5rem; text-align: center; margin: 2rem 0; padding-bottom: 1rem; border-bottom: 2px solid var(--bg1); }
        h2 { margin-top: 2.5rem; color: var(--main); }
        .btn { display: inline-block; padding: 12px 24px; margin-top: 1rem; color: var(--white); background: var(--main3); border-radius: 5px; cursor: pointer; text-align: center; border: none; font-size: 1rem; font-family: var(--montserrat); transition: var(--trensition); }
        .btn:hover { background: var(--bg1); }
        .btn-danger { background: #f75842; margin-left: 10px; }
        .btn-danger:hover { background: #e0432d; }
        .admin-section { background: var(--main5); padding: 2rem; margin-bottom: 2rem; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        .management-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1.5rem; }
        .item-card { background: var(--main3); border-radius: 8px; overflow: hidden; text-align: center; padding: 1rem; transition: var(--trensition); display: flex; flex-direction: column; justify-content: space-between; }
        .item-card:hover { transform: translateY(-5px); box-shadow: 0 8px 20px rgba(0,0,0,0.4); }
        .item-card img, .item-card video { width: 100%; height: 150px; object-fit: cover; border-radius: 5px; margin-bottom: 1rem; }
        .item-card p { font-size: 0.9rem; color: var(--dwhite); margin-bottom: 1rem; flex-grow: 1; }
        .form-group { margin-bottom: 1.5rem; }
        .form-group label { display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--Vwhite); }
        .form-group input[type="file"], .form-group input[type="text"], .form-group textarea { width: 100%; padding: 10px; border-radius: 5px; border: 1px solid var(--bg1); background: var(--main4); color: var(--white); font-family: var(--montserrat); }
        .back-link { display: inline-block; margin: 2rem 0 0 2rem; color: var(--main); text-decoration: none; font-weight: 500; }
        .back-link i { margin-right: 8px; }
        @media screen and (max-width: 600px) {
            .management-grid { grid-template-columns: 1fr; }
        }
            /* ... (Existing CSS remains, adding the facility-card style) */
    .facility-card { padding: 1rem; text-align: left; }
    .facility-card i { font-size: 2rem; color: var(--main); }
    .facility-card h5 { margin-top: 0.5rem; }
    /* ... (rest of the CSS) */
    </style>
</head>
<body>
    <a href="index.html" class="back-link"><i class='bx bx-arrow-back'></i>Back to Home</a>
    <div class="container">
        <h1>Admin Control Panel</h1>

        <section class="admin-section">
            <h2>Manage Header Images (index)</h2>
            <div id="header-images-grid" class="management-grid"></div>
            <div class="form-group">
                <label for="new-image-upload">Upload New Header Image</label>
                <input type="file" id="new-image-upload" accept="image/*">
                <p id="image-upload-status" style="display: none; color: #ebd978;">Uploading...</p>
                <button class="btn" onclick="addImage()">Add Image</button>
            </div>
        </section>

        <section class="admin-section">
            <h2>Manage Highlight Videos (index)</h2>
            <div id="videos-grid" class="management-grid"></div>
            <div class="form-group">
                <label for="new-video-upload">Upload New Video</label>
                <input type="file" id="new-video-upload" accept="video/*">
            </div>
            <div class="form-group">
                <label for="new-video-description">Video Description</label>
                <input type="text" id="new-video-description" placeholder="e.g., Enzo Fernandez funny moment...">
            </div>
            <p id="video-upload-status" style="display: none; color: #ebd978;">Uploading...</p>
            <button class="btn" onclick="addVideo()">Add Video</button>
        </section>
        
        <section class="admin-section">
            <h2>Manage Live Reports / Testimonials</h2>
            <div id="testimonials-grid" class="management-grid"></div>
            <div class="form-group">
                <label for="new-testimonial-avatar">Avatar Image</label>
                <input type="file" id="new-testimonial-avatar" accept="image/*">
            </div>
            <div class="form-group">
                <label for="new-testimonial-name">Person's Name</label>
                <input type="text" id="new-testimonial-name" placeholder="e.g., David Okereke">
            </div>
            <div class="form-group">
                <label for="new-testimonial-role">Role</label>
                <input type="text" id="new-testimonial-role" placeholder="e.g., Football Analyst">
            </div>
            <div class="form-group">
                <label for="new-testimonial-body">Quote / Message</label>
                <textarea id="new-testimonial-body" rows="4" placeholder="Enter the testimonial message here..."></textarea>
            </div>
            <p id="testimonial-upload-status" style="display: none; color: #ebd978;">Uploading avatar...</p>
            <button class="btn" onclick="addTestimonial()">Add Testimonial</button>
        </section>

        <section class="admin-section">
            <h2>Manage Highlight Videos (indexhighlight.html)</h2>
            <div id="highlight-videos-grid" class="management-grid"></div>
            <div class="form-group">
                <label for="new-highlight-video-upload">Upload New Highlight Video</label>
                <input type="file" id="new-highlight-video-upload" accept="video/*">
            </div>
            <div class="form-group">
                <label for="new-highlight-video-description">Highlight Video Description</label>
                <input type="text" id="new-highlight-video-description" placeholder="e.g., Match Highlights 2024 (highlight)">
            </div>
            <p id="highlight-video-upload-status" style="display: none; color: #ebd978;">Uploading...</p>
            <button class="btn" onclick="addHighlightVideo()">Add Highlight Video</button>
        </section>
    </div>

    <script>
// --- SUPABASE CONFIGURATION ---
const SUPABASE_URL = 'https://hzduwqstaowpllqmuwrc.supabase.co'; 
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh6ZHV3cXN0YW93cGxscW11d3JjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg2NjM4NDgsImV4cCI6MjA3NDIzOTg0OH0.V0QQ_au79MtQ7T6p6uDn_c2xkMrIt2L5QwqF_InN9eM'; 

const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

const IMAGE_BUCKET = 'images'; 
const VIDEO_BUCKET = 'videos';
const AVATAR_BUCKET = 'avatars';

// --- TABLE NAMES (CRITICAL CHANGE) ---
const IMAGE_TABLE = 'crypticLegionImages';
const MAIN_VIDEO_TABLE = 'crypticLegionVideos'; // Used for index.html (Your original VIDEO_TABLE)
const HIGHLIGHT_VIDEO_TABLE = 'crypticLegionHighlightVideos'; // NEW TABLE for indexhighlight.html
const TESTIMONIAL_TABLE = 'crypticLegionTestimonials';
    
// Helper to upload file to Supabase Storage (Unchanged)
const uploadFileToSupabaseStorage = async (file, bucket, statusElement) => {
    // ... (logic remains the same) ...
};

// Helper to fetch all data from a table and render (Unchanged)
const fetchAndRender = async (tableName, renderFunc) => {
    // ... (logic remains the same) ...
};

document.addEventListener('DOMContentLoaded', function() {
    // DOM Elements & Status Messages (CRITICAL CHANGE: Update references)
    const imagesGrid = document.getElementById('header-images-grid');
    const mainVideosGrid = document.getElementById('main-videos-grid'); // New ID
    const highlightVideosGrid = document.getElementById('highlight-videos-grid'); // New ID
    const testimonialsGrid = document.getElementById('testimonials-grid');
    
    const imageUploadStatus = document.getElementById('image-upload-status');
    const mainVideoUploadStatus = document.getElementById('main-video-upload-status'); // New ID
    const highlightVideoUploadStatus = document.getElementById('highlight-video-upload-status'); // New ID
    const testimonialUploadStatus = document.getElementById('testimonial-upload-status');
    
    // --- RENDER FUNCTIONS ---
    const renderImages = (images) => {
        // ... (logic remains the same) ...
    };

    // RENDER FUNCTION FOR MAIN VIDEOS (index.html)
    const renderMainVideos = (videos) => {
        mainVideosGrid.innerHTML = ''; // Use the new mainVideosGrid
        videos.forEach(video => {
            const safeDescription = video.description.replace(/'/g, "\\'");
            
            const card = document.createElement('div');
            card.className = 'item-card';
            card.innerHTML = `
                <video src="${video.src}" controls loop></video>
                <p id="main-desc-${video.id}">${video.description}</p> 
                <div style="display: flex; justify-content: center; gap: 5px; margin-top: auto;">
                    <button class="btn" style="background: var(--bg1); margin-top: 0;" onclick="editMainVideo(${video.id}, '${safeDescription}')">Edit</button>
                    <button class="btn btn-danger" style="margin-top: 0;" onclick="deleteItem('${MAIN_VIDEO_TABLE}', ${video.id}, 'main-video')">Delete</button>
                </div>`;
            mainVideosGrid.appendChild(card);
        });
    };

    // RENDER FUNCTION FOR HIGHLIGHT VIDEOS (indexhighlight.html)
    const renderHighlightVideos = (videos) => {
        highlightVideosGrid.innerHTML = ''; // Use the new highlightVideosGrid
        videos.forEach(video => {
            const safeDescription = video.description.replace(/'/g, "\\'");
            
            const card = document.createElement('div');
            card.className = 'item-card';
            card.innerHTML = `
                <video src="${video.src}" controls loop></video>
                <p id="highlight-desc-${video.id}">${video.description}</p> 
                <div style="display: flex; justify-content: center; gap: 5px; margin-top: auto;">
                    <button class="btn" style="background: var(--bg1); margin-top: 0;" onclick="editHighlightVideo(${video.id}, '${safeDescription}')">Edit</button>
                    <button class="btn btn-danger" style="margin-top: 0;" onclick="deleteItem('${HIGHLIGHT_VIDEO_TABLE}', ${video.id}, 'highlight-video')">Delete</button>
                </div>`;
            highlightVideosGrid.appendChild(card);
        });
    };

    const renderTestimonials = (testimonials) => {
        // ... (logic remains the same) ...
    };
    
    // --- DELETE FUNCTION (MODIFIED: Checks new table/type) ---
    window.deleteItem = async (tableName, id, type) => {
        if (confirm('Are you sure you want to delete this item? This will be removed from Supabase.')) {
            const { error } = await supabase
                .from(tableName)
                .delete()
                .eq('id', id);

            if (error) {
                alert(`Deletion Failed: ${error.message}`);
                console.error('Deletion Error:', error);
            } else {
                alert('Item deleted successfully!');
                if (type === 'image') await fetchAndRender(IMAGE_TABLE, renderImages);
                else if (type === 'main-video') await fetchAndRender(MAIN_VIDEO_TABLE, renderMainVideos);
                else if (type === 'highlight-video') await fetchAndRender(HIGHLIGHT_VIDEO_TABLE, renderHighlightVideos); // Re-render highlight videos
                else if (type === 'testimonial') await fetchAndRender(TESTIMONIAL_TABLE, renderTestimonials);
            }
        }
    };

    // --- ADD FUNCTIONS ---
    window.addImage = async () => { /* ... (Unchanged logic) ... */ };
    
    // ADD FUNCTION FOR MAIN VIDEOS (index.html)
    window.addMainVideo = async () => {
        const videoInput = document.getElementById('new-main-video-upload'); // New ID
        const descInput = document.getElementById('new-main-video-description'); // New ID
        const file = videoInput.files[0];
        if (!file || !descInput.value.trim()) { alert('Please select a video file and provide a description.'); return; }

        try {
            const downloadURL = await uploadFileToSupabaseStorage(file, VIDEO_BUCKET, mainVideoUploadStatus); // New status ID

            const { error } = await supabase.from(MAIN_VIDEO_TABLE).insert([{ src: downloadURL, description: descInput.value.trim() }]);
            
            if (error) throw new Error(error.message);

            videoInput.value = ''; 
            descInput.value = ''; 
            alert('Main Video uploaded and saved successfully!');
            await fetchAndRender(MAIN_VIDEO_TABLE, renderMainVideos); // New render function

        } catch (error) {
            alert('Main Video operation failed: ' + error.message);
        }
    };

    // ADD FUNCTION FOR HIGHLIGHT VIDEOS (indexhighlight.html)
    window.addHighlightVideo = async () => {
        const videoInput = document.getElementById('new-highlight-video-upload'); // New ID
        const descInput = document.getElementById('new-highlight-video-description'); // New ID
        const file = videoInput.files[0];
        if (!file || !descInput.value.trim()) { alert('Please select a video file and provide a description.'); return; }

        try {
            const downloadURL = await uploadFileToSupabaseStorage(file, VIDEO_BUCKET, highlightVideoUploadStatus); // New status ID

            // CRITICAL: Insert into the NEW highlight table
            const { error } = await supabase.from(HIGHLIGHT_VIDEO_TABLE).insert([{ src: downloadURL, description: descInput.value.trim() }]);
            
            if (error) throw new Error(error.message);

            videoInput.value = ''; 
            descInput.value = ''; 
            alert('Highlight Video uploaded and saved successfully!');
            await fetchAndRender(HIGHLIGHT_VIDEO_TABLE, renderHighlightVideos); // New render function

        } catch (error) {
            alert('Highlight Video operation failed: ' + error.message);
        }
    };

    window.addTestimonial = async () => { /* ... (Unchanged logic) ... */ };

    // --- EDIT FUNCTIONS ---
    // EDIT FUNCTION FOR MAIN VIDEOS (index.html)
    window.editMainVideo = async (videoId, currentDescription) => {
        const newDescription = prompt("Enter the new description for Main Video ID " + videoId + ":", currentDescription);

        if (newDescription === null || newDescription.trim() === currentDescription) {
            alert("Edit canceled or no change detected.");
            return;
        }

        const trimmedDescription = newDescription.trim();
        
        try {
            const { error } = await supabase
                .from(MAIN_VIDEO_TABLE) // Use the MAIN video table
                .update({ description: trimmedDescription })
                .eq('id', videoId); 

            if (error) throw error;

            alert('Main Video description updated successfully!');
            
            const descElement = document.getElementById(`main-desc-${videoId}`); // Use main ID
            if (descElement) { descElement.textContent = trimmedDescription; }

        } catch (error) {
            console.error('Main Video update failed:', error.message);
            alert(`Main Video update failed. Supabase error: ${error.message}`);
        }
    };
    
    // EDIT FUNCTION FOR HIGHLIGHT VIDEOS (indexhighlight.html)
    window.editHighlightVideo = async (videoId, currentDescription) => {
        const newDescription = prompt("Enter the new description for Highlight Video ID " + videoId + ":", currentDescription);

        if (newDescription === null || newDescription.trim() === currentDescription) {
            alert("Edit canceled or no change detected.");
            return;
        }

        const trimmedDescription = newDescription.trim();
        
        try {
            const { error } = await supabase
                .from(HIGHLIGHT_VIDEO_TABLE) // CRITICAL: Use the HIGHLIGHT video table
                .update({ description: trimmedDescription })
                .eq('id', videoId); 

            if (error) throw error;

            alert('Highlight Video description updated successfully!');
            
            const descElement = document.getElementById(`highlight-desc-${videoId}`); // Use highlight ID
            if (descElement) { descElement.textContent = trimmedDescription; }

        } catch (error) {
            console.error('Highlight Video update failed:', error.message);
            alert(`Highlight Video update failed. Supabase error: ${error.message}`);
        }
    };

    // --- INITIAL RENDER ON PAGE LOAD (CRITICAL CHANGE: Load all data sets) ---
    fetchAndRender(IMAGE_TABLE, renderImages);
    fetchAndRender(MAIN_VIDEO_TABLE, renderMainVideos); // Load main page videos
    fetchAndRender(HIGHLIGHT_VIDEO_TABLE, renderHighlightVideos); // Load highlight page videos
    fetchAndRender(TESTIMONIAL_TABLE, renderTestimonials);
    
    // ... (Your other placeholder functions for addImage/addTestimonial) ...
});
    </script>
</body>
</html>
